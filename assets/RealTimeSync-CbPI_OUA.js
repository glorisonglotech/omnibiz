import{j as r}from"./radix-vendor-B3KJ3-F4.js";import{r as o}from"./react-vendor-DyCm8Hca.js";import{F as D,o as m,G as b}from"./index-CrmIEb1e.js";import{t as a,W as L,R as g,j as R}from"./ui-vendor-7Lw9ZtLE.js";import"./socket-vendor-CA1CrNgP.js";import"./chart-vendor-DSBLL5zb.js";const I=({onProductUpdate:w,onOrderUpdate:x,onStockUpdate:y,onManualRefresh:S,pollingInterval:p=3e4})=>{const k=D(),t=k?.socket,n=k?.connected||!1,[$,c]=o.useState(new Date),[j,d]=o.useState("idle"),[l,f]=o.useState(0),[E,M]=o.useState("auto"),u=o.useCallback(e=>{console.log("Product updated:",e),w?.(e),f(s=>s+1),a.info(`Product "${e.name}" was updated`,{icon:"ðŸ“¦",duration:3e3}),c(new Date)},[w]),i=o.useCallback(e=>{console.log("Order updated:",e),x?.(e),f(s=>s+1),a.info(`Order #${e.orderId} status: ${e.status}`,{icon:"ðŸ›’",duration:3e3}),c(new Date)},[x]),h=o.useCallback(e=>{console.log("Stock updated:",e),y?.(e),f(s=>s+1),e.stockQuantity<=e.reorderLevel&&a.warning(`Low stock alert: ${e.productName}`,{icon:"âš ï¸",duration:5e3,description:`Only ${e.stockQuantity} units remaining`}),c(new Date)},[y]);o.useEffect(()=>{if(!(!t||!n))return t.on("product:updated",u),t.on("product:created",u),t.on("product:deleted",e=>{a.error(`Product "${e.name}" was deleted`,{icon:"ðŸ—‘ï¸"}),c(new Date)}),t.on("order:updated",i),t.on("order:created",i),t.on("order:statusChanged",e=>{a.success(`Order #${e.orderId} is now ${e.status}`,{icon:"âœ…"}),i(e)}),t.on("stock:updated",h),t.on("stock:lowAlert",e=>{a.warning(`Stock Alert: ${e.productName}`,{icon:"âš ï¸",description:`Current stock: ${e.stockQuantity} (Reorder at: ${e.reorderLevel})`,duration:7e3})}),()=>{t.off("product:updated",u),t.off("product:created",u),t.off("product:deleted"),t.off("order:updated",i),t.off("order:created",i),t.off("order:statusChanged"),t.off("stock:updated",h),t.off("stock:lowAlert")}},[t,n,u,i,h]),o.useEffect(()=>{if(!p)return;const s=setInterval(async()=>{d("syncing");try{c(new Date),d("idle")}catch(C){console.error("Polling error:",C),d("error")}},p);return()=>clearInterval(s)},[p]),o.useEffect(()=>{if(l>0){const e=setTimeout(()=>{f(0)},5e3);return()=>clearTimeout(e)}},[l]);const v=()=>{const s=Math.floor((new Date-$)/1e3);return s<60?`${s}s ago`:s<3600?`${Math.floor(s/60)}m ago`:`${Math.floor(s/3600)}h ago`},N=async()=>{d("syncing");try{await S?.(),c(new Date),d("idle"),a.success("Data refreshed successfully!")}catch{d("error"),a.error("Failed to refresh data")}};return r.jsxs("div",{className:"flex items-center gap-3 text-sm flex-wrap",children:[r.jsx(m,{variant:n?"default":"secondary",className:b("gap-2 transition-all cursor-pointer",n&&"bg-green-600 hover:bg-green-700"),onClick:n?void 0:N,title:n?"Real-time updates active":"Click to refresh data manually",children:n?r.jsxs(r.Fragment,{children:[r.jsx(L,{className:"h-3 w-3"}),"Live"]}):r.jsxs(r.Fragment,{children:[r.jsx(g,{className:"h-3 w-3"}),"Local Mode"]})}),j==="syncing"&&r.jsxs(m,{variant:"secondary",className:"gap-2",children:[r.jsx(g,{className:"h-3 w-3 animate-spin"}),"Syncing..."]}),j==="error"&&r.jsxs(m,{variant:"destructive",className:"gap-2",children:[r.jsx(R,{className:"h-3 w-3"}),"Sync Error"]}),l>0&&r.jsxs(m,{variant:"outline",className:"gap-2 animate-bounce",children:[r.jsx(g,{className:"h-3 w-3"}),l," update",l!==1?"s":""]}),r.jsxs("span",{className:"text-muted-foreground text-xs",children:["Last sync: ",v()]})]})};export{I as default};
